%h1 Iterations for #{@engagement.app.name}

%h3= engagement_short_name(@engagement)

%div.stat
  - @stat.each do |key, value|
    %h4= key
    %div{:style => "width: #{value * 100 + 50}px"}= "%.1f / 5.0" % value

%p.explanation Click on iteration end date to edit iteration data.

= link_to 'Add Iteration...', new_engagement_iteration_path(@engagement), :class => 'btn btn-primary'
= link_to 'Back to App', app_path(@engagement.app), :class => 'btn btn-primary'

%table.table
  %thead
    %tr
      %th Iteration End
      %th Customer Feedback
      %th Demeanor
      %th Engagement
      %th Communication
      %th Understanding
      %th Effectiveness
  %tbody
    - @engagement.iterations.each do |iter|
      - h = iter.customer_feedback_to_hash || Hash.new
      %tr
        %td= link_to iter.end_date.strftime('%F'), edit_engagement_iteration_path(@engagement,iter)
        %td
          %table
            %tr
              %td="engagement: " + (h["engaged_text"] || " ")
            %tr
              %td="communication: " + (h["communication_text"]  || " ")
            %tr
              %td="understanding: " + (h["understanding_text"] || " ")
            %tr
              %td="effectiveness: " + (h["effectiveness_text"] || " ")
            %tr
              %td="customer satisfaction: " + (h["satisfied_text"] || " ")
        %td= Iteration.rating_to_score(h['demeanor'])
        %td= Iteration.rating_to_score(h["engaged"])
        %td= Iteration.rating_to_score(h["communication"])
        %td= Iteration.rating_to_score(h["understanding"])
        %td= Iteration.rating_to_score(h["effectiveness"])